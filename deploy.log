ðŸ… POMOPOMO Safe Deployment Script
====================================

âš ï¸  IMPORTANT: This server has other sites running!
    We will deploy POMOPOMO to /opt/pomopomo
    and configure it on a separate port/subdomain.


ðŸ“‹ Pre-flight checks...
âœ… Environment file found

ðŸ“¤ Uploading files to server...
sending incremental file list
./
.env.production

sent 2.746 bytes  received 65 bytes  1.874,00 bytes/sec
total size is 429.241  speedup is 152,70
âœ… Files uploaded

ðŸ”§ Setting up on server...
Pseudo-terminal will not be allocated because stdin is not a terminal.
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-85-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Tue Oct 28 12:17:36 UTC 2025

  System load:           2.69
  Usage of /:            16.2% of 192.69GB
  Memory usage:          64%
  Swap usage:            97%
  Processes:             294
  Users logged in:       0
  IPv4 address for ens3: 51.38.190.127
  IPv4 address for ens3: 51.38.190.126
  IPv6 address for ens3: 2001:41d0:305:2100::7a63

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

22 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

12 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm


*** System restart required ***
ðŸ“¦ Installing Docker (if needed)...
âœ… Docker already installed

ðŸ” Generating secrets...
âœ… Secrets generated

ðŸ³ Building and starting containers...
time="2025-10-28T12:17:40Z" level=warning msg="/home/ubuntu/pomopomo/docker-compose.custom.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
#1 [internal] load local bake definitions
#1 reading from stdin 882B done
#1 DONE 0.0s

#2 [ws internal] load build definition from Dockerfile.ws
#2 transferring dockerfile: 355B done
#2 DONE 0.0s

#3 [web internal] load build definition from Dockerfile
#3 transferring dockerfile: 1.31kB done
#3 DONE 0.0s

#4 [web internal] load metadata for docker.io/library/node:20-alpine
#4 DONE 0.3s

#5 [web internal] load .dockerignore
#5 transferring context: 231B done
#5 DONE 0.0s

#6 [web 1/6] FROM docker.io/library/node:20-alpine@sha256:6178e78b972f79c335df281f4b7674a2d85071aae2af020ffa39f0a770265435
#6 DONE 0.0s

#7 [web runner  3/10] RUN addgroup --system --gid 1001 nodejs
#7 CACHED

#8 [web runner  4/10] RUN adduser --system --uid 1001 nextjs
#8 CACHED

#9 [ws internal] load build context
#9 transferring context: 81.34kB 0.0s done
#9 DONE 0.0s

#10 [web deps 4/4] RUN npm ci --include=dev
#10 CACHED

#11 [web builder 3/6] COPY --from=deps /app/node_modules ./node_modules
#11 CACHED

#12 [ws 2/6] WORKDIR /app
#12 CACHED

#13 [ws 3/6] COPY package.json package-lock.json* ./
#13 CACHED

#14 [ws 4/6] RUN npm ci --only=production
#14 CACHED

#15 [web builder 4/6] COPY . .
#15 DONE 0.1s

#16 [ws 5/6] COPY . .
#16 DONE 0.1s

#17 [ws 6/6] RUN npx prisma generate
#17 ...

#18 [web builder 5/6] RUN npx prisma generate || echo "Prisma already generated"
#18 86.73 npm error code EAI_AGAIN
#18 86.73 npm error syscall getaddrinfo
#18 86.73 npm error errno EAI_AGAIN
#18 86.73 npm error request to https://registry.npmjs.org/prisma failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org
#18 86.74 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-28T12_17_41_172Z-debug-0.log
#18 86.76 Prisma already generated
#18 DONE 86.8s

#17 [ws 6/6] RUN npx prisma generate
#17 86.82 npm error code EAI_AGAIN
#17 86.82 npm error syscall getaddrinfo
#17 86.82 npm error errno EAI_AGAIN
#17 86.82 npm error request to https://registry.npmjs.org/prisma failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org
#17 86.82 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-28T12_17_41_158Z-debug-0.log
#17 ERROR: process "/bin/sh -c npx prisma generate" did not complete successfully: exit code: 1

#19 [web builder 6/6] RUN npm run build
#19 0.380 runc run failed: container process is already dead
#19 CANCELED
------
 > [ws 6/6] RUN npx prisma generate:
86.82 npm error code EAI_AGAIN
86.82 npm error syscall getaddrinfo
86.82 npm error errno EAI_AGAIN
86.82 npm error request to https://registry.npmjs.org/prisma failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org
86.82 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-28T12_17_41_158Z-debug-0.log
------
Dockerfile.ws:15

--------------------

  13 |     

  14 |     # Generate Prisma Client

  15 | >>> RUN npx prisma generate

  16 |     

  17 |     # Expose WS port

--------------------

target ws: failed to solve: process "/bin/sh -c npx prisma generate" did not complete successfully: exit code: 1

